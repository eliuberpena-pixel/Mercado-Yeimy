<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 400px;
            margin: 50px auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            border: 2px solid #e0e0e0;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
            box-shadow: none;
        }
        
        .error {
            color: #ff4757;
            text-align: center;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .link {
            text-align: center;
            margin-top: 20px;
            color: #667eea;
            cursor: pointer;
            font-weight: 500;
        }
        
        /* HEADER TIENDA */
        .header {
            background: white;
            padding: 15px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        /* NAVEGACI√ìN */
        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            padding: 12px 20px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        /* PRODUCTOS */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 80px;
        }
        
        .product-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
        }
        
        .product-card h4 {
            margin: 10px 0;
            color: #333;
        }
        
        .product-card .price {
            color: #667eea;
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        /* CARRITO */
        .cart-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .cart-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cart-controls button {
            width: auto;
            padding: 5px 10px;
            margin: 0;
        }
        
        /* AJUSTES */
        .settings-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .settings-section h3 {
            text-align: left;
            margin-bottom: 15px;
            color: #667eea;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        /* MEN√ö INFERIOR */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.3s;
        }
        
        .nav-item.active {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .card {
                padding: 20px;
                margin: 20px auto;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
    </style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="card">
    <h1>üõí Tienda Online</h1>
    <p style="text-align: center; color: #666; margin-bottom: 30px;">Inicia sesi√≥n para continuar</p>
    
    <input type="text" id="loginUser" placeholder="Usuario o tel√©fono">
    <input type="password" id="loginPass" placeholder="Contrase√±a">
    
    <div id="loginError" class="error hidden"></div>
    
    <button onclick="login()">Iniciar Sesi√≥n</button>
    
    <div class="link" onclick="mostrarRegistro()">¬øNo tienes cuenta? Reg√≠strate aqu√≠</div>
</div>

<!-- REGISTRO -->
<div id="registro" class="card hidden">
    <h2>Crear Nueva Cuenta</h2>
    
    <input type="text" id="regNombre" placeholder="Nombre completo">
    <input type="text" id="regTelefono" placeholder="Tel√©fono">
    <input type="password" id="regPass" placeholder="Contrase√±a (m√≠nimo 4 caracteres)">
    <input type="password" id="regPass2" placeholder="Confirmar contrase√±a">
    
    <div id="regError" class="error hidden"></div>
    
    <button onclick="registrar()">Crear Cuenta</button>
    
    <div class="link" onclick="mostrarLogin()">‚Üê Volver al inicio de sesi√≥n</div>
</div>

<!-- TIENDA -->
<div id="tienda" class="hidden">
    <!-- HEADER -->
    <div class="header">
        <h2 id="nombreTienda">Mi Tienda</h2>
        <div>
            <span id="saludoUsuario" style="margin-right: 15px; font-weight: 500;"></span>
            <button onclick="logout()" class="btn-secondary" style="width: auto; padding: 8px 15px;">Cerrar Sesi√≥n</button>
        </div>
    </div>

    <!-- NAVEGACI√ìN -->
    <div class="nav">
        <button class="nav-btn active" onclick="mostrarSeccion('productos')">üõçÔ∏è Productos</button>
        <button class="nav-btn" onclick="mostrarSeccion('carrito')">üõí Carrito (<span id="contadorCarrito">0</span>)</button>
        <button class="nav-btn" onclick="mostrarSeccion('perfil')">üë§ Perfil</button>
        <button class="nav-btn" onclick="mostrarSeccion('ajustes')">‚öôÔ∏è Ajustes</button>
        <button id="btnAdmin" class="nav-btn hidden" onclick="mostrarSeccion('admin')">üîß Admin</button>
    </div>

    <!-- PRODUCTOS -->
    <div id="seccionProductos">
        <h3>Productos Disponibles</h3>
        <div class="products-grid" id="listaProductos"></div>
    </div>

    <!-- CARRITO -->
    <div id="seccionCarrito" class="hidden">
        <h3>Mi Carrito de Compras</h3>
        <div id="itemsCarrito">
            <p style="text-align: center; color: #666; padding: 40px;">El carrito est√° vac√≠o</p>
        </div>
        <div class="settings-section">
            <h3>Resumen del Pedido</h3>
            <p style="font-size: 24px; font-weight: bold; text-align: center;">
                Total: $<span id="totalCarrito">0.00</span>
            </p>
            <button onclick="hacerPedido()">‚úÖ Realizar Pedido</button>
        </div>
    </div>

    <!-- PERFIL -->
    <div id="seccionPerfil" class="hidden">
        <div class="settings-section">
            <h3>üë§ Mi Perfil</h3>
            <input type="text" id="perfilNombre" placeholder="Nombre completo">
            <input type="text" id="perfilTelefono" placeholder="Tel√©fono">
            <input type="password" id="perfilPass" placeholder="Nueva contrase√±a (dejar vac√≠o para no cambiar)">
            <button onclick="guardarPerfil()">üíæ Guardar Cambios</button>
        </div>
        
        <div class="settings-section">
            <h3>üìã Mis Pedidos</h3>
            <div id="historialPedidos">
                <p style="text-align: center; color: #666; padding: 20px;">No tienes pedidos a√∫n</p>
            </div>
        </div>
    </div>

    <!-- AJUSTES -->
    <div id="seccionAjustes" class="hidden">
        <div class="settings-section">
            <h3>‚öôÔ∏è Configuraci√≥n de la Tienda</h3>
            <input type="text" id="ajusteNombreTienda" placeholder="Nombre de la tienda">
            <input type="text" id="ajusteWhatsApp" placeholder="N√∫mero de WhatsApp para pedidos">
            <textarea id="ajusteDescripcion" placeholder="Descripci√≥n de la tienda" rows="3"></textarea>
            <button onclick="guardarAjustes()">üíæ Guardar Ajustes</button>
        </div>
    </div>

    <!-- ADMIN -->
    <div id="seccionAdmin" class="hidden">
        <div class="settings-section">
            <h3>üîß Panel de Administraci√≥n</h3>
            <h4>Agregar Nuevo Producto</h4>
            <input type="text" id="adminNombreProducto" placeholder="Nombre del producto">
            <input type="number" id="adminPrecioProducto" placeholder="Precio" step="0.01">
            <select id="adminCategoriaProducto">
                <option value="cafe">Caf√©</option>
                <option value="pan">Panader√≠a</option>
                <option value="bebida">Bebidas</option>
                <option value="otros">Otros</option>
            </select>
            <button onclick="agregarProductoAdmin()">‚ûï Agregar Producto</button>
        </div>
        
        <div class="settings-section">
            <h4>Productos Existentes</h4>
            <div id="listaProductosAdmin"></div>
        </div>
    </div>

    <!-- MEN√ö INFERIOR (m√≥vil) -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="mostrarSeccion('productos')">
            <span style="font-size: 20px;">üõçÔ∏è</span>
            <span style="font-size: 12px;">Productos</span>
        </div>
        <div class="nav-item" onclick="mostrarSeccion('carrito')">
            <span style="font-size: 20px;">üõí</span>
            <span style="font-size: 12px;">Carrito</span>
        </div>
        <div class="nav-item" onclick="mostrarSeccion('perfil')">
            <span style="font-size: 20px;">üë§</span>
            <span style="font-size: 12px;">Perfil</span>
        </div>
        <div class="nav-item" onclick="mostrarSeccion('ajustes')">
            <span style="font-size: 20px;">‚öôÔ∏è</span>
            <span style="font-size: 12px;">Ajustes</span>
        </div>
    </div>
</div>

<script>
// ====================
// DATOS EN MEMORIA
// ====================
let usuarioActual = null;
let carrito = [];
let productos = [];
let usuarios = [];
let pedidos = [];
let ajustes = {
    nombreTienda: "Mi Tienda Online",
    whatsapp: "1234567890",
    descripcion: "La mejor tienda online"
};

// ====================
// FUNCIONES B√ÅSICAS
// ====================
function mostrarLogin() {
    document.getElementById('registro').classList.add('hidden');
    document.getElementById('login').classList.remove('hidden');
}

function mostrarRegistro() {
    document.getElementById('login').classList.add('hidden');
    document.getElementById('registro').classList.remove('hidden');
}

function mostrarError(id, mensaje) {
    const errorDiv = document.getElementById(id);
    errorDiv.textContent = mensaje;
    errorDiv.classList.remove('hidden');
}

function limpiarError(id) {
    document.getElementById(id).classList.add('hidden');
}

// ====================
// INICIALIZAR DATOS
// ====================
function inicializarDatos() {
    // Usuario admin por defecto
    usuarios = [{
        id: 1,
        nombre: "Administrador",
        telefono: "admin",
        password: "0012",
        tipo: "admin"
    }];
    
    // Productos por defecto
    productos = [{
        id: 1,
        nombre: "Caf√© Americano",
        precio: 2.50,
        categoria: "cafe"
    }, {
        id: 2,
        nombre: "Capuccino",
        precio: 3.00,
        categoria: "cafe"
    }, {
        id: 3,
        nombre: "Croissant",
        precio: 1.80,
        categoria: "pan"
    }, {
        id: 4,
        nombre: "Jugo Natural",
        precio: 2.00,
        categoria: "bebida"
    }];
    
    // Cargar desde localStorage si existe
    cargarDesdeLocalStorage();
}

function cargarDesdeLocalStorage() {
    try {
        const datos = JSON.parse(localStorage.getItem('tiendaDatos'));
        if (datos) {
            if (datos.usuarios) usuarios = datos.usuarios;
            if (datos.productos) productos = datos.productos;
            if (datos.pedidos) pedidos = datos.pedidos;
            if (datos.ajustes) ajustes = datos.ajustes;
            if (datos.carrito) carrito = datos.carrito;
        }
    } catch (e) {
        console.log("Error cargando datos:", e);
    }
}

function guardarEnLocalStorage() {
    const datos = {
        usuarios: usuarios,
        productos: productos,
        pedidos: pedidos,
        ajustes: ajustes,
        carrito: carrito
    };
    localStorage.setItem('tiendaDatos', JSON.stringify(datos));
}

// ====================
// LOGIN
// ====================
function login() {
    const user = document.getElementById('loginUser').value.trim();
    const pass = document.getElementById('loginPass').value.trim();
    
    limpiarError('loginError');
    
    if (!user || !pass) {
        mostrarError('loginError', 'Por favor completa todos los campos');
        return;
    }
    
    // Buscar usuario
    const usuario = usuarios.find(u => 
        (u.telefono === user || u.nombre === user) && u.password === pass
    );
    
    if (usuario) {
        usuarioActual = usuario;
        mostrarTienda();
    } else {
        mostrarError('loginError', 'Usuario o contrase√±a incorrectos');
    }
}

// ====================
// REGISTRO
// ====================
function registrar() {
    const nombre = document.getElementById('regNombre').value.trim();
    const telefono = document.getElementById('regTelefono').value.trim();
    const pass = document.getElementById('regPass').value.trim();
    const pass2 = document.getElementById('regPass2').value.trim();
    
    limpiarError('regError');
    
    // Validaciones
    if (!nombre || !telefono || !pass || !pass2) {
        mostrarError('regError', 'Por favor completa todos los campos');
        return;
    }
    
    if (pass !== pass2) {
        mostrarError('regError', 'Las contrase√±as no coinciden');
        return;
    }
    
    if (pass.length < 4) {
        mostrarError('regError', 'La contrase√±a debe tener al menos 4 caracteres');
        return;
    }
    
    // Verificar si ya existe
    if (usuarios.some(u => u.telefono === telefono)) {
        mostrarError('regError', 'Este tel√©fono ya est√° registrado');
        return;
    }
    
    // Crear nuevo usuario
    const nuevoUsuario = {
        id: Date.now(),
        nombre: nombre,
        telefono: telefono,
        password: pass,
        tipo: "cliente"
    };
    
    usuarios.push(nuevoUsuario);
    usuarioActual = nuevoUsuario;
    
    guardarEnLocalStorage();
    mostrarTienda();
}

// ====================
// TIENDA
// ====================
function mostrarTienda() {
    document.getElementById('login').classList.add('hidden');
    document.getElementById('registro').classList.add('hidden');
    document.getElementById('tienda').classList.remove('hidden');
    
    // Mostrar informaci√≥n del usuario
    document.getElementById('saludoUsuario').textContent = `Hola, ${usuarioActual.nombre}`;
    document.getElementById('nombreTienda').textContent = ajustes.nombreTienda;
    
    // Mostrar/ocultar bot√≥n admin
    if (usuarioActual.tipo === "admin") {
        document.getElementById('btnAdmin').classList.remove('hidden');
    } else {
        document.getElementById('btnAdmin').classList.add('hidden');
    }
    
    // Cargar datos iniciales
    cargarProductos();
    cargarPerfil();
    cargarAjustes();
    actualizarContadorCarrito();
}

function logout() {
    if (confirm('¬øEst√°s seguro de cerrar sesi√≥n?')) {
        usuarioActual = null;
        guardarEnLocalStorage();
        
        document.getElementById('tienda').classList.add('hidden');
        document.getElementById('login').classList.remove('hidden');
        
        document.getElementById('loginUser').value = '';
        document.getElementById('loginPass').value = '';
    }
}

// ====================
// NAVEGACI√ìN
// ====================
function mostrarSeccion(seccion) {
    // Ocultar todas las secciones
    document.querySelectorAll('[id^="seccion"]').forEach(el => {
        el.classList.add('hidden');
    });
    
    // Remover activo de botones
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Mostrar secci√≥n seleccionada
    document.getElementById(`seccion${seccion.charAt(0).toUpperCase() + seccion.slice(1)}`).classList.remove('hidden');
    
    // Marcar como activo
    document.querySelectorAll(`.nav-btn, .nav-item`).forEach(el => {
        if (el.textContent.includes(seccion.charAt(0).toUpperCase() + seccion.slice(1).toLowerCase())) {
            el.classList.add('active');
        }
    });
    
    // Actualizar contenido seg√∫n secci√≥n
    if (seccion === 'carrito') {
        mostrarCarrito();
    } else if (seccion === 'perfil') {
        cargarPerfil();
        cargarHistorial();
    } else if (seccion === 'admin') {
        cargarProductosAdmin();
    }
}

// ====================
// PRODUCTOS
// ====================
function cargarProductos() {
    const container = document.getElementById('listaProductos');
    container.innerHTML = '';
    
    productos.forEach(producto => {
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
            <h4>${producto.nombre}</h4>
            <p class="price">$${producto.precio.toFixed(2)}</p>
            <button onclick="ag
