<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda Online Simple</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #f5f5f5;
            padding: 20px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            margin: 50px auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .error {
            color: red;
            text-align: center;
            margin: 10px 0;
        }
        
        .link {
            text-align: center;
            margin-top: 20px;
            color: #007bff;
            cursor: pointer;
        }
        
        /* TIENDA */
        .header {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .productos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 80px;
        }
        
        .producto {
            background: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .producto img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        /* MEN√ö INFERIOR */
        .menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .menu-item {
            text-align: center;
            padding: 10px;
            cursor: pointer;
        }
        
        .menu-item.active {
            color: #007bff;
            font-weight: bold;
        }
        
        /* SECCIONES */
        .seccion {
            background: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 80px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .carrito-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <!-- PANTALLA LOGIN -->
    <div id="login" class="card">
        <h2>Iniciar Sesi√≥n</h2>
        <input type="text" id="loginUser" placeholder="Tel√©fono o usuario">
        <input type="password" id="loginPass" placeholder="Contrase√±a">
        <div id="loginError" class="error hidden"></div>
        <button onclick="hacerLogin()">Entrar</button>
        <div class="link" onclick="mostrarRegistro()">Crear nueva cuenta</div>
    </div>
    
    <!-- PANTALLA REGISTRO -->
    <div id="registro" class="card hidden">
        <h2>Crear Cuenta</h2>
        <input type="text" id="regNombre" placeholder="Nombre completo">
        <input type="text" id="regUser" placeholder="Tel√©fono">
        <input type="password" id="regPass" placeholder="Contrase√±a">
        <input type="password" id="regPass2" placeholder="Confirmar contrase√±a">
        <div id="regError" class="error hidden"></div>
        <button onclick="hacerRegistro()">Crear cuenta</button>
        <div class="link" onclick="mostrarLogin()">Volver al login</div>
    </div>
    
    <!-- TIENDA -->
    <div id="tienda" class="hidden">
        <!-- HEADER -->
        <div class="header">
            <h3 id="nombreTienda">Mi Tienda</h3>
            <button onclick="cerrarSesion()" style="width: auto; padding: 8px 15px;">Salir</button>
        </div>
        
        <!-- SECCI√ìN PRODUCTOS -->
        <div id="seccionProductos">
            <div class="productos" id="listaProductos">
                <!-- Productos se cargan aqu√≠ -->
            </div>
        </div>
        
        <!-- SECCI√ìN CARRITO -->
        <div id="seccionCarrito" class="seccion hidden">
            <h3>Mi Carrito</h3>
            <div id="itemsCarrito"></div>
            <div style="margin-top: 20px; text-align: right;">
                <h4>Total: $<span id="totalCarrito">0</span></h4>
                <button onclick="hacerPedido()">Hacer Pedido</button>
            </div>
        </div>
        
        <!-- SECCI√ìN PERFIL -->
        <div id="seccionPerfil" class="seccion hidden">
            <h3>Mi Perfil</h3>
            <input type="text" id="perfilNombre" placeholder="Nombre">
            <input type="text" id="perfilTelefono" placeholder="Tel√©fono" readonly>
            <input type="password" id="perfilPass" placeholder="Nueva contrase√±a (opcional)">
            <button onclick="guardarPerfil()">Guardar cambios</button>
        </div>
        
        <!-- SECCI√ìN HISTORIAL -->
        <div id="seccionHistorial" class="seccion hidden">
            <h3>Mis Pedidos</h3>
            <div id="listaHistorial"></div>
        </div>
        
        <!-- MEN√ö INFERIOR -->
        <div class="menu">
            <div class="menu-item active" onclick="mostrar('productos')">üõí Productos</div>
            <div class="menu-item" onclick="mostrar('carrito')">üõçÔ∏è Carrito</div>
            <div class="menu-item" onclick="mostrar('perfil')">üë§ Perfil</div>
            <div class="menu-item" onclick="mostrar('historial')">üìã Historial</div>
        </div>
    </div>

    <script>
        // ====== DATOS INICIALES ======
        let usuarioLogeado = null;
        let carrito = [];
        
        // Productos de ejemplo
        let productos = [
            {id: 1, nombre: "Caf√© Americano", precio: 2.50, img: "https://images.unsplash.com/photo-1498804103079-a6351b050096?w=400&h=300&fit=crop"},
            {id: 2, nombre: "Capuccino", precio: 3.00, img: "https://images.unsplash.com/photo-1511537190424-bbbab87ac5eb?w=400&h=300&fit=crop"},
            {id: 3, nombre: "Croissant", precio: 1.80, img: "https://images.unsplash.com/photo-1555507036-ab794f27d2e9?w=400&h=300&fit=crop"},
            {id: 4, nombre: "Jugo Natural", precio: 2.00, img: "https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?w=400&h=300&fit=crop"}
        ];
        
        // Usuarios (admin predefinido)
        let usuarios = [
            {id: 1, nombre: "Administrador", telefono: "56666168", password: "0012", tipo: "admin"}
        ];
        
        let pedidos = [];
        
        // ====== FUNCIONES B√ÅSICAS ======
        function mostrarLogin() {
            document.getElementById('registro').classList.add('hidden');
            document.getElementById('login').classList.remove('hidden');
        }
        
        function mostrarRegistro() {
            document.getElementById('login').classList.add('hidden');
            document.getElementById('registro').classList.remove('hidden');
        }
        
        function mostrarError(id, mensaje) {
            const errorDiv = document.getElementById(id);
            errorDiv.textContent = mensaje;
            errorDiv.classList.remove('hidden');
        }
        
        function limpiarError(id) {
            document.getElementById(id).classList.add('hidden');
        }
        
        // ====== LOGIN SIMPLE ======
        function hacerLogin() {
            const user = document.getElementById('loginUser').value.trim();
            const pass = document.getElementById('loginPass').value.trim();
            
            limpiarError('loginError');
            
            if (!user || !pass) {
                mostrarError('loginError', 'Completa todos los campos');
                return;
            }
            
            // Buscar usuario
            const usuario = usuarios.find(u => 
                (u.telefono === user || u.nombre === user) && u.password === pass
            );
            
            if (usuario) {
                usuarioLogeado = usuario;
                localStorage.setItem('usuarioLogeado', JSON.stringify(usuario));
                iniciarTienda();
            } else {
                mostrarError('loginError', 'Usuario o contrase√±a incorrectos');
            }
        }
        
        // ====== REGISTRO SIMPLE ======
        function hacerRegistro() {
            const nombre = document.getElementById('regNombre').value.trim();
            const telefono = document.getElementById('regUser').value.trim();
            const pass = document.getElementById('regPass').value.trim();
            const pass2 = document.getElementById('regPass2').value.trim();
            
            limpiarError('regError');
            
            // Validaciones b√°sicas
            if (!nombre || !telefono || !pass || !pass2) {
                mostrarError('regError', 'Completa todos los campos');
                return;
            }
            
            if (pass !== pass2) {
                mostrarError('regError', 'Las contrase√±as no coinciden');
                return;
            }
            
            if (pass.length < 4) {
                mostrarError('regError', 'La contrase√±a debe tener al menos 4 caracteres');
                return;
            }
            
            // Verificar si ya existe
            if (usuarios.some(u => u.telefono === telefono)) {
                mostrarError('regError', 'Este tel√©fono ya est√° registrado');
                return;
            }
            
            // Crear nuevo usuario
            const nuevoUsuario = {
                id: Date.now(),
                nombre: nombre,
                telefono: telefono,
                password: pass,
                tipo: "cliente"
            };
            
            usuarios.push(nuevoUsuario);
            usuarioLogeado = nuevoUsuario;
            localStorage.setItem('usuarioLogeado', JSON.stringify(nuevoUsuario));
            
            // Guardar usuarios
            localStorage.setItem('usuarios', JSON.stringify(usuarios));
            
            iniciarTienda();
        }
        
        // ====== INICIAR TIENDA ======
        function iniciarTienda() {
            // Ocultar login/registro
            document.getElementById('login').classList.add('hidden');
            document.getElementById('registro').classList.add('hidden');
            
            // Mostrar tienda
            document.getElementById('tienda').classList.remove('hidden');
            
            // Cargar datos guardados
            cargarDatosGuardados();
            
            // Mostrar productos
            mostrarProductos();
            
            // Cargar perfil
            cargarPerfil();
        }
        
        function cargarDatosGuardados() {
            // Cargar usuarios
            const usuariosGuardados = localStorage.getItem('usuarios');
            if (usuariosGuardados) {
                usuarios = JSON.parse(usuariosGuardados);
            }
            
            // Cargar pedidos
            const pedidosGuardados = localStorage.getItem('pedidos');
            if (pedidosGuardados) {
                pedidos = JSON.parse(pedidosGuardados);
            }
            
            // Cargar carrito
            const carritoGuardado = localStorage.getItem('carrito');
            if (carritoGuardado) {
                carrito = JSON.parse(carritoGuardado);
            }
        }
        
        // ====== PRODUCTOS ======
        function mostrarProductos() {
            const container = document.getElementById('listaProductos');
            container.innerHTML = '';
            
            productos.forEach(producto => {
                const div = document.createElement('div');
                div.className = 'producto';
                div.innerHTML = `
                    <img src="${producto.img}" alt="${producto.nombre}">
                    <h4>${producto.nombre}</h4>
                    <p>Precio: $${producto.precio}</p>
                    <button onclick="agregarACarrito(${producto.id})" style="width: 100%;">Agregar</button>
                `;
                container.appendChild(div);
            });
        }
        
        function agregarACarrito(id) {
            const producto = productos.find(p => p.id === id);
            if (!producto) return;
            
            // Verificar si ya est√° en el carrito
            const itemExistente = carrito.find(item => item.id === id);
            
            if (itemExistente) {
                itemExistente.cantidad++;
            } else {
                carrito.push({
                    ...producto,
                    cantidad: 1
                });
            }
            
            // Guardar carrito
            localStorage.setItem('carrito', JSON.stringify(carrito));
            
            alert(`${producto.nombre} agregado al carrito`);
            
            // Actualizar carrito si est√° visible
            if (!document.getElementById('seccionCarrito').classList.contains('hidden')) {
                mostrarCarrito();
            }
        }
        
        // ====== NAVEGACI√ìN ======
        function mostrar(seccion) {
            // Ocultar todas las secciones
            document.getElementById('seccionProductos').classList.add('hidden');
            document.getElementById('seccionCarrito').classList.add('hidden');
            document.getElementById('seccionPerfil').classList.add('hidden');
            document.getElementById('seccionHistorial').classList.add('hidden');
            
            // Remover activo del men√∫
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Mostrar secci√≥n seleccionada
            document.getElementById(`seccion${seccion.charAt(0).toUpperCase() + seccion.slice(1)}`).classList.remove('hidden');
            
            // Marcar como activo en el men√∫
            document.querySelectorAll('.menu-item').forEach(item => {
                if (item.textContent.includes(seccion.charAt(0).toUpperCase() + seccion.slice(1))) {
                    item.classList.add('active');
                }
            });
            
            // Actualizar contenido seg√∫n secci√≥n
            if (seccion === 'carrito') {
                mostrarCarrito();
            } else if (seccion === 'historial') {
                mostrarHistorial();
            }
        }
        
        // ====== CARRITO ======
        function mostrarCarrito() {
            const container = document.getElementById('itemsCarrito');
            const totalSpan = document.getElementById('totalCarrito');
            
            if (carrito.length === 0) {
                container.innerHTML = '<p>El carrito est√° vac√≠o</p>';
                totalSpan.textContent = '0';
                return;
            }
            
            let total = 0;
            container.innerHTML = '';
            
            carrito.forEach((item, index) => {
                const subtotal = item.precio * item.cantidad;
                total += subtotal;
                
                const div = document.createElement('div');
                div.className = 'carrito-item';
                div.innerHTML = `
                    <div>
                        <strong>${item.nombre}</strong><br>
                        $${item.precio} x ${item.cantidad} = $${subtotal.toFixed(2)}
                    </div>
                    <div>
                        <button onclick="cambiarCantidad(${index}, -1)" style="width: auto; padding: 5px 10px;">-</button>
                        <button onclick="cambiarCantidad(${index}, 1)" style="width: auto; padding: 5px 10px;">+</button>
                        <button onclick="quitarDelCarrito(${index})" style="width: auto; padding: 5px 10px; background: red;">X</button>
                    </div>
                `;
                container.appendChild(div);
            });
            
            totalSpan.textContent = total.toFixed(2);
        }
        
        function cambiarCantidad(index, cambio) {
            carrito[index].cantidad += cambio;
            
            if (carrito[index].cantidad <= 0) {
                carrito.splice(index, 1);
            }
            
            localStorage.setItem('carrito', JSON.stringify(carrito));
            mostrarCarrito();
        }
        
        function quitarDelCarrito(index) {
            if (confirm('¬øEliminar este producto del carrito?')) {
                carrito.splice(index, 1);
                localStorage.setItem('carrito', JSON.stringify(carrito));
                mostrarCarrito();
            }
        }
        
        // ====== PEDIDOS ======
        function hacerPedido() {
            if (carrito.length === 0) {
                alert('El carrito est√° vac√≠o');
                return;
            }
            
            const total = carrito.reduce((sum, item) => sum + (item.precio * item.cantidad), 0);
            const pedido = {
                id: Date.now(),
                fecha: new Date().toLocaleString(),
                cliente: usuarioLogeado.nombre,
                telefono: usuarioLogeado.telefono,
                productos: [...carrito],
                total: total,
                estado: 'Pendiente'
            };
            
            pedidos.push(pedido);
            localStorage.setItem('pedidos', JSON.stringify(pedidos));
            
            // Crear mensaje para WhatsApp
            let mensaje = `NUEVO PEDIDO #${pedido.id}\n\n`;
            mensaje += `Cliente: ${usuarioLogeado.nombre}\n`;
            mensaje += `Tel√©fono: ${usuarioLogeado.telefono}\n\n`;
            mensaje += `Productos:\n`;
            
            pedido.productos.forEach(item => {
                mensaje += `- ${item.nombre} x${item.cantidad} - $${(item.precio * item.cantidad).toFixed(2)}\n`;
            });
            
            mensaje += `\nTotal: $${total.toFixed(2)}`;
            
            // Limpiar carrito
            carrito = [];
            localStorage.setItem('carrito', JSON.stringify(carrito));
            
            alert('Pedido enviado!\nSe abrir√° WhatsApp para enviar el pedido.');
            
            // Abrir WhatsApp (n√∫mero fijo por ahora)
            const url = `https://wa.me/1234567890?text=${encodeURIComponent(mensaje)}`;
            window.open(url, '_blank');
            
            // Volver a productos
            mostrar('productos');
            mostrarCarrito();
        }
        
        // ====== PERFIL ======
        function cargarPerfil() {
            if (!usuarioLogeado) return;
            
            document.getElementById('perfilNombre').va
